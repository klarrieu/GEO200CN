---
title: "GEO 200CN Lab 3"
author: "Kenneth Larrieu"
output: html_document
---

## Part 1.  Introduction to spatial data in *R*

First work through http://www.rspatial.org/spatial/
There is quite a lot of stuff, so go through it quickly. It is a reference. 

Upload to Canvas this Rmarkdown file (and a pdf compilation) after adding R code and some text such to answer the questions below.

Consider answering by writing sentences that use inline R commands like this 5 + 5 = `r 5+5`. 

For this exercise __only use the sp and raster packages__ (and indirectly, packages such as rgdal that raster may use in the background). 

*Questions*

1) read the shapefile "galap.shp" (in galap.zip) into R to create a SpatialPolygonsDataFrame. 

```{r}
library(sp)
library(raster)

galap = shapefile('galap/galap.shp')
```

2) show the class of the object in R

```{r}
class(galap)
```

3) how many polygons are there in this object? 

```{r}
length(galap)
```

4) how many variables are there in this object?

```{r}
ncol(galap)
```

5) make a plot of the islands (their outlines)

```{r}
plot(galap, main='Galapagos Islands')
```

6) make a scatter plot of the number of species as a function of the size of the island

```{r}
plot(galap$area, galap$species, main='Galapagos Islands Species Distribution', xlab='Island Area', ylab='Num. of Species')
```

7) what quantity might you use to make a choropleth to represent the number of species on each island?

We might take the number of species `galap$species`, or normalize this by the island area to have a measure of species density across the island: `galap$species/galap$area`.

8) create that quantity as a new variable in the SpatialPolyonsDataFrame and plot it with "spplot"

```{r}
galap$spc_dens = galap$species/galap$area
spplot(galap, 'spc_dens', main='Species Density')
```

9) select the largest island and save it to a new shapefile

```{r}
biggest = galap[which(galap$area == max(galap$area)),]
shapefile(biggest, 'biggest.shp', overwrite=TRUE)
```

10) download elevation data for Ecuador (use the "getData" in the raster package)

```{r}
ecu = getData('alt', country='Ecuador', download=TRUE)
```

11) use the crop function in the raster package and then map the elevation data (add the island outlines)

```{r}
# transform coordinates to match that of ecuador data (latlong)
galap = spTransform(galap, crs(ecu))
# crop elevation raster
el = crop(ecu, galap)
# plot it
plot(el, main='Galapagos Islands Elevation', xlab='long', ylab='lat')
plot(galap, add=TRUE)
```

12) create a contour map of elevation in Ecuador. 

```{r}
contour(ecu, nlevels=8, main='Ecuador Contour Map', xlab='long', ylab='lat')
```

## Part 2. Pattern and Process

Please read https://rspatial.org/rosu/Chapter4.html

And answer the questions in a single *R Markdown* file + pdf.

*1.* Use the examples provided above to write a script that follows the 'thought exercise to fix ideas' on page 98 of OSU.

```{r}
set.seed(0)
# initialize raster w/ 8x8 grid
r = raster(xmn=0, xmx=7, ymn=0, ymx=7, ncol=8, nrow=8)
# X component raster
X = init(r, 'x')
# Y component raster
Y = init(r, 'y')
# z = 2x + 3y +/- (random value from 0:9)
R = 2*X + 3*Y + setValues(r, sample(c(-9:0, 0:9), ncell(r), replace=TRUE))
plot(R)
contour(R, add=TRUE)
```

*2.* Use the example of the CSR points maps to write a script that uses a normal distribution, rather than a random uniform distribution (also see box 'different distributions'; on page 99 of OSU).

```{r}
csr = function(n, plot=FALSE) {
    # sample values from standard normal distribution
    x = rnorm(n)
    y = rnorm(n)
    if (plot) {
        # make plot showing within 3 SDs of mean
        plot(x, y, xlim=c(-3,3), ylim=c(-3,3))
    }
}

set.seed(0)
par(mfrow=c(2,2), mai=c(.5, .5, .5, .5))
for (i in 1:4) {
    csr(50, plot=TRUE)
}
```

*3.* Do the generated chess boards look (positively or negatively) spatially autocorrelated?

The generated chess boards appear to have little to no spatial autocorrelation. It does not appear strongly positive or negative because there is no apparent clustering (which would indicate positive autocorrelation) or checkerboard/diffuse patterning (which would indicate negative autocorrelation).

*4.* How would you, conceptually, statistically test whether the real chessboard used in games is generated by an independent random process?

If the chessboard is generated by an independent random process, then cells are assigned randomly as black or white, meaning the probability of a cell being black or white is not dependent on neighboring cells, which implies that there is no spatial autocorrelation. So if spatial autocorrelation is zero (or sufficiently close to zero) then it may likely have been generated by an independent random process.

*5.* (bonus) Can you explain the odd distribution pattern of random line lengths inside a rectangle?

First of all, for a rectangle with dimensions $W, H$ (with $W > H$) we know the distribution must have values ranging from $0$ to $\sqrt{W^2+H^2}$. For any random point picked, there are exactly two angles which yield a specific line length, and the location of the point constrains the possible line lengths. For instance, a point near a corner may have a line length anywhere between 0 and $\sqrt{W^2+H^2}$, while the point in the center of the rectangle may have a line length anywhere between $H$ and $\sqrt{W^2+H^2}$.

To account for the path lengths less than $H$, we must consider how paths of these lengths can occur. For instance, a path length of $0$ can only occur at an edge, and the further from the edges, the larger the minimum path length, up until reaching a central region for which the minimum path length is $H$. Thus, the smaller the path length $(<H)$, the less area exists from which a point could yield such a path length. This explains the increase in probability from $0$ to $H$.

Now consider a randomly selected point. If the angle is horizontal, then the line will have length $W$ (excluding points on the edges). For a differential change in angle from horizontal, points will have a line length slightly greater than $W$. The rate of change of this length increases as the angle increases, up until the intersection of the line with a rectangle corner. Similarly, if the angle is vertical, the line will have length $H$, while differential changes from this angle create line lengths slightly greater than $H$, with the rate of change of length also increasing with the change in angle until the intersection with a rectangle corner. Since the angle is uiformly distributed, and since the path length changes most slowly with angle for angles close to horizontal or vertical, we can conclude that probabilities are highest for path lengths slightly greater than or equal to $W$ and $H$, with the decline in probability for higher values due to the fact that path length changes at a faster rate for angles farther from horizontal or vertical.
